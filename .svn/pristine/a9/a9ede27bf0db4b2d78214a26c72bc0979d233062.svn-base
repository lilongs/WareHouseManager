using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using BULayer;

namespace InventoryManagersystem.ProductManager
{
    public partial class frmProductSupplierInfoAdd : Form
    {
        BUUpdateProSupInfo myBUUpdateProSupInfo = new BUUpdateProSupInfo();
        BUInsertProSupInfo myBUInsertProSupInfo = new BUInsertProSupInfo();
        BUGetProduct_SupID myBUGetProductID = new BUGetProduct_SupID();

        string paramProductID_2 = string.Empty;
        string paramSupplierID_2 = string.Empty;

        public frmProductSupplierInfoAdd()
        {
            InitializeComponent();
        }
        public frmProductSupplierInfoAdd(string paramProductID, string paramProductName, string paramSupplierID, string paramSupplierName, string paramPrice, string paramRemark)
        {
            InitializeComponent();
            this.combProductName.Text = paramSupplierName;
            this.paramProductID_2 = paramProductID;
            this.combProductName.Enabled = false;

            this.combSupplierName.Text = paramSupplierName;
            this.paramSupplierID_2 = paramSupplierID;
            this.combSupplierName.Enabled = false;

            this.txtPrice.Text = paramPrice;
            this.txtRemark.Text = paramRemark;
            this.Text = "修改贸易信息";
        }

        private void button2_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        public void SetCombProductID()
        {
            DataTable myDt = new DataTable();
            myDt = myBUGetProductID.GetProductID();
            combProductName.DataSource = myDt;
            combProductName.DisplayMember = "ProductName";
            combProductName.ValueMember = "ProductID";
        }
        public void SetCombSupplierID()
        {
            DataTable myDt = new DataTable();
            myDt = myBUGetProductID.GetSupplierID();
            combSupplierName.DataSource = myDt;
            combSupplierName.DisplayMember = "Name";
            combSupplierName.ValueMember = "SupplierID";
        }

        private void button1_Click(object sender, EventArgs e)
        {
            if (paramProductID_2.Length == 0 &&paramSupplierID_2.Length==0)
            {
                string paramProductName = combProductName.SelectedValue.ToString();
                string paramSupplierName = combSupplierName.SelectedValue.ToString();
                string paramPrice = txtPrice.Text.Trim();
                string paramRemark = txtRemark.Text.Trim();

                int i = myBUInsertProSupInfo.InsertSupplier(paramProductName, paramSupplierName, paramPrice, paramRemark);
                if (i > 0)
                {
                    MessageBox.Show("添加成功");
                    this.DialogResult = DialogResult.OK;
                }
                else
                {
                    MessageBox.Show("添加失败");
                }
            }
            else
            {
                string paramPrice = txtPrice.Text.Trim();
                string paramRemark = txtRemark.Text.Trim();
                int i = myBUUpdateProSupInfo.UpdateProSupInfo(paramProductID_2,paramSupplierID_2,paramPrice,paramRemark);
                if (i > 0)
                {
                    MessageBox.Show("修改成功");
                    this.DialogResult = DialogResult.OK;
                }
                else
                {
                    MessageBox.Show("修改失败");
                }
            }
        }

        private void frmProductSupplierInfoAdd_Load(object sender, EventArgs e)
        {
            SetCombProductID();
            SetCombSupplierID();
        }
    }
}
